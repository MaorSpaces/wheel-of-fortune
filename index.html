<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wheel of Fortune â€” Daily Spin</title>
<style>
    body { 
        font-family: Arial, sans-serif; 
        background: #f9f9f9; 
        margin: 20px; 
        color: #222;
        text-align: center;
    }
    h1 { color: #333; margin-bottom: 10px; }
    .wheel-container { 
        display: inline-block; 
        margin: 20px; 
        text-align: center; 
        background: white; 
        border-radius: 20px; 
        padding: 15px 20px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    canvas { 
        border: 1px solid #ddd; 
        background: white; 
        border-radius: 50%; 
    }
    button { 
        margin: 10px; 
        padding: 8px 16px; 
        border: none; 
        border-radius: 8px; 
        background: #4ECDC4; 
        color: white; 
        font-weight: bold; 
        cursor: pointer; 
        transition: 0.2s ease-in-out;
    }
    button:hover { background: #3bb3a9; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    .history { 
        width: 300px; 
        height: 150px; 
        border: 1px solid #ccc; 
        overflow-y: auto; 
        margin-top: 10px; 
        padding: 5px; 
        border-radius: 8px; 
        background: #fefefe;
        text-align: left;
    }
</style>
</head>
<body>
<h1>Wheel of Fortune</h1>

<div class="wheel-container">
    <h2>Chores</h2>
    <canvas id="choresCanvas" width="400" height="400"></canvas>
    <br><button id="spinChores" onclick="spinWheel('chores')">Spin</button>
    <div id="choresHistory" class="history"></div>
</div>

<div class="wheel-container">
    <h2>Activities</h2>
    <canvas id="activitiesCanvas" width="400" height="400"></canvas>
    <br><button id="spinActivities" onclick="spinWheel('activities')">Spin</button>
    <div id="activitiesHistory" class="history"></div>
</div>

<div style="margin-top: 30px;">
    <a href="https://docs.google.com/spreadsheets/d/11d-OkdlQXgecLnv3zTay3huNwsl6nmk1YfVnDMe4F-g/edit?usp=sharing" 
       target="_blank" 
       style="color:#4ECDC4; font-weight:bold; text-decoration:none; font-size:18px;">
        Click Here For Suggestions
    </a>
</div>

<script>
const choresDecisions = ["WashCar", "Clean Office", "Meal Prep", "Talk to a girl", "Self Grooming", "Organize Social Night"];
const activitiesDecisions = ["Walk the Trail", "Read a Book", "Lego", "Grocery&Cook", "Excercise", "Bike Ride"];

const wheels = {
    chores: { canvasId: 'choresCanvas', historyId: 'choresHistory', decisions: choresDecisions, currentAngle: 0 },
    activities: { canvasId: 'activitiesCanvas', historyId: 'activitiesHistory', decisions: activitiesDecisions, currentAngle: 0 }
};

const colors = ["#FF6B6B", "#FFD93D", "#6BCB77", "#4D96FF", "#FF8C42", "#9B59B6", "#00A8E8", "#FFB6C1"];
let isSpinning = false;

function drawWheel(canvasId, rotationAngle, decisions) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width/2, centerY = canvas.height/2, radius = Math.min(centerX, centerY) - 10;
    const numDecisions = decisions.length;
    const anglePerSegment = 2 * Math.PI / numDecisions;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let i=0; i<numDecisions; i++) {
        const startAngle = rotationAngle + i*anglePerSegment;
        const endAngle = startAngle + anglePerSegment;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(centerX, centerY);
        const textAngle = startAngle + anglePerSegment/2;
        ctx.rotate(textAngle);
        ctx.fillStyle = '#222';
        ctx.font = adaptFont(decisions[i], radius);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(decisions[i], radius*0.6, 0);
        ctx.restore();
    }

    // pointer
    ctx.beginPath();
    ctx.moveTo(centerX, 6);
    ctx.lineTo(centerX-12, 34);
    ctx.lineTo(centerX+12, 34);
    ctx.closePath();
    ctx.fillStyle='red';
    ctx.fill();
}

function adaptFont(text, radius) {
    const base = Math.max(12, Math.floor(radius/8));
    if(text.length>15) return `bold ${base-4}px Arial`;
    if(text.length>10) return `bold ${base-2}px Arial`;
    return `bold ${base}px Arial`;
}

drawWheel('choresCanvas', wheels.chores.currentAngle, choresDecisions);
drawWheel('activitiesCanvas', wheels.activities.currentAngle, activitiesDecisions);

// --- LocalStorage daily spin check ---
function canSpinToday(wheelName) {
    const today = new Date().toISOString().slice(0,10);
    const lastSpin = localStorage.getItem(`${wheelName}-lastSpin`);
    return lastSpin !== today;
}

function recordSpin(wheelName, result) {
    const today = new Date().toISOString().slice(0,10);
    localStorage.setItem(`${wheelName}-lastSpin`, today);
    localStorage.setItem(`${wheelName}-lastResult`, result);
}

function getSelectedIndex(angle, numSegments){
    const normalized = ((-angle % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI);
    return Math.floor(normalized / (2*Math.PI/numSegments)) % numSegments;
}

// --- Google Sheet integration ---
const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxRBmUkCcoAHamWu3rd6wzcV0Yekw6hLSHunTYYGAu-ZpUF80UD5xdPkveULk0_bbgk/exec';

function sendToSheet(wheelName, result){
    const now = new Date().toISOString();
    fetch(GOOGLE_SHEET_URL, {
        method: 'POST',
        body: JSON.stringify({wheel: wheelName, result: result, timestamp: now})
    })
    .then(res => res.json())
    .then(data => console.log('Sheet saved:', data))
    .catch(err => console.error('Error saving to sheet:', err));
}

function spinWheel(which) {
    if(isSpinning) return;
    isSpinning = true;
    document.getElementById('spinChores').disabled=true;
    document.getElementById('spinActivities').disabled=true;

    const wheel = wheels[which];
    const decisions = wheel.decisions;
    const steps = 120;
    const totalAngle = Math.random()*3*2*Math.PI + 5*2*Math.PI; // 5-8 rotations
    const stepAngle = totalAngle/steps;
    let step = 0;

    function animate() {
        if(step < steps){
            wheel.currentAngle += stepAngle;
            drawWheel(wheel.canvasId, wheel.currentAngle, decisions);
            step++;
            requestAnimationFrame(animate);
        } else {
            const selIndex = getSelectedIndex(wheel.currentAngle, decisions.length);
            const selected = decisions[selIndex];
            const now = new Date().toISOString().slice(0,19).replace('T',' ');
            document.getElementById(wheel.historyId).innerHTML += `<div>${now}: ${selected}</div>`;
            sendToSheet(which, selected); // still sends to Google Sheet
            isSpinning = false;
            document.getElementById('spinChores').disabled=false;
            document.getElementById('spinActivities').disabled=false;
        }
    }
    animate();
}
</script>
</body>
</html>
